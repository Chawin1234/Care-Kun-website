<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Care_Kun</title> 
  <link rel="stylesheet" href="style.css"/>
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

  <style> 
    .slide {
      display: none;
    }
    .active {
      display: block;
    } 
  </style>
</head>
<body>

  <!-- Login Form -->
  <div class="LGwrapper slide active" id="slide2">
    <form action="" id="loginForm6">
      <h1>LOGIN</h1>

      <div class="role">
        <label>เลือกประเภทผู้ใช้:</label>
        <button class="PS" onclick="changePlaceholder('staff')">บุคลากร</button>
        <button class="IN" onclick="changePlaceholder('general')">บุคคลทั่วไป</button>
      </div>

      <div class="username">
        <i class='bx bx-user'></i> 
        <label id="first">PROVIDER ID :</label>
        <input type="text" id="login-id" placeholder="กรอกเลขบัตรประชาชน 13หลัก" required />
      </div>

      <div class="password">
        <i class='bx bx-lock'></i>
        <label>PASSWORD :</label>
        <input type="password" id="login-password" placeholder="กรอเบอร์โทรศัพท์ เช่น 012XXXXXXX" required />
      </div>

      <div class="submit">
        <button type="submit" class="btn">LOGIN</button>
      </div>

      <div class="register">
        <p>Don't have an account?</p>
        <button type="button" class="btn" onclick="showSlide(6)">สมัครบุคลากร</button>

      </div>
    </form>
  </div>

  <!-- Register(6) Form -->
   <div class="RG6 slide" id="slide6">
    <form action="" id ="registerForm6">
      <h6>สมัครบุคลากร</h6>
        <div class="provider">
          <label>PROVIDER ID :</label>
          <input type="text" id="register-id-staff" placeholder="กรอกข้อมูลของคุณ" required />
        </div>
        <div class="passwordStaff">
          <label>PASSWORD :</label>
          <input type="password" id="register-password-staff" placeholder="กรอกรหัสผ่าน" required />
        </div>
        <div class="nameStaff">
          <label>ชื่อ-นามสกุล</label>
          <input type="text" placeholder="กรอกข้อมูลของคุณ" required>
        </div>
        <div class="phoneStaff">
          <label>เบอร์โทรศัพท์</label>
          <input type="text" id="register-phone-staff" placeholder="กรอกเบอร์โทรศัพท์" required />
        </div>
        <div class="emailStaff">
          <label>อีเมล</label>
          <input type="email" placeholder="กรอกข้อมูลของคุณ">
        </div>
        <div class="RegisterStaff">
          <button type="submit" class="btn">REGISTER</button>
        </div>
        <div class="loginStaff">
          <p><a href="#" onclick="showSlide(2)">back</a></p>
        </div>
    </form>
   </div>

  <!-- Register Form -->
  <div class="RGwrapper slide" id="slide1">
    <form action="" id ="registerForm7">
      <h2>REGISTER</h2>

      <div class="number">
                <label>เลขบัตรประจําตัวประชาชน/หนังสือเดินทาง</label>
                <input type="text" id="register-id" placeholder="กรอกเลขบัตรประชาชน" required />
      </div>  
      <div class="HN">
                <label>เลขHNผู้ป่วย</label>
                <input type="text" id="HN-id" placeholder="กรอกเลขHNผู้ป่วย" required />
      </div>
      <div class="room">
                <label>เลขห้อง</label>
                <input type="text" class="room" id="room-id" placeholder="กรอกเลขห้องผู้ป่วย" required />
      </div>
            

             <div class="name">
                <label>ชื่อ-นามสกุล</label>
                <input type="text" placeholder="กรอกข้อมูลของคุณ" required>
            </div>

            <div class="gender">
                <label><input type="radio" name="gender" value="male"> ชาย</label>
                <label><input type="radio" name="gender" value="female"> หญิง</label>
                <label><input type="radio" name="gender" value="other"> อื่นๆ</label>

            </div>

             <div class="birthdate">
                <label>วัน/เดือน/ปี(พ.ศ.) เกิด</label>
                <input type="text" placeholder="DD" required>
                <input type="text" placeholder="MM" required>
                <input type="text" placeholder="YY" required><br>
                <label>อายุ</label>
                <input type="text" placeholder="ระบุ" required>
            </div>

            <div class = "blood">
                <label>กรุ๊ปเลือด</label>
                <label><input type="radio" name="blood" value="A">A</label>
                <label><input type="radio" name="blood" value="B">B</label> 
                <label><input type="radio" name="blood" value="AB">AB</label>
                <label><input type="radio" name="blood" value="O">O</label>
                <label><input type="radio" name="Rh" value="Positive">Positive</label>
                <label><input type="radio" name="Rh" value="Negative">Negative</label>
                <label><input type="radio" name="Unknown" value="Unknown">ไม่ทราบหมู่เลือด</label>
            </div>

            <div class="religion">
                <label>ศาสนา</label>
                <input type="text" placeholder="กรอกข้อมูลของคุณ" required>
            </div>

        
            <div class="phone">
                <label>เบอร์โทรศัพท์</label>
                <input type="text" id="register-password" placeholder="กรอกเบอร์โทรศัพท์" required />
            </div>

            <div class="email">
                <label>อีเมล</label>
                <input type="email" placeholder="กรอกข้อมูลของคุณ">
            </div>

           
            
            <div class="address">
                <label>ที่อยู่</label>
                <input type="text" placeholder="กรอกข้อมูลของคุณ" required>
            </div>

            <div class="allergy">
                <label><input type="checkbox">แพ้ยา</label>
                <label><input type="checkbox">แพ้อาหาร</label>
                <label><input type="checkbox">โรคประจำตัว</label>
                    <input type="text" placeholder= "โปรดระบุ" >
            </div>

            <div class="relation">
                <label>สถานะภาพสมรส</label>
                <label><input type="radio" name="relation" value="single">โสด</label>
                <label><input type="radio" name="relation" value="married">สมรส</label>
                <label><input type="radio" name="relation" value="divorced">หย่าร้าง</label>
                <label><input type="radio" name="relation" value="widowed">หม้าย</label>
                <label><input type="radio" name="relation" value="separated">แยกกันอยู่</label>
                <label><input type="radio" name="relation" value="Unkonwn">เคยสมรสแต่ไม่ทราบสถานภาพสมรส</label>   
            </div>
            
            <div class="emergency">
                <label>ชื่อผู้ติดต่อกรณีฉุกเฉิน</label>
                <input type="text" placeholder="กรอกข้อมูลของคุณ" required>
                <label>เบอร์โทรศัพท์ผู้ติดต่อกรณีฉุกเฉิน</label>
                <input type="text" placeholder="กรอกข้อมูลของคุณ" required>
            </div>
            

             <div class="parentsname">
                <label>ชื่อ-นามสกุลบิดา</label>
                <input type="text" placeholder="กรอกข้อมูลของคุณ" required>
                <label>โรคประจําตัว</label>
                <input type="text"placeholder= "โปรดระบุ" ><br>
                <label>ชื่อ-นามสกุลมารดา</label>
                <input type="text" placeholder="กรอกข้อมูลของคุณ" required>
                <label>โรคประจําตัว</label>
                <input type="text"placeholder= "โปรดระบุ" > 
            </div>

            <div class="symptoms">
                <label>อาการผู้ป่วย</label>
                <input type="text" placeholder="กรอกข้อมูลของคุณ" required>
            </div>    

             <div class="allow">
                <input type="checkbox" id="agree">
                <label for="agree">ฉันยินยอมตามเงื่อนไข</label>
            </div>

      <div class="submit">
        <button type="submit" class="btn" >REGISTER</button>
      </div>

      <div class="login">
        <a href="#" onclick="showSlide(3)">back</a></p>
      </div>
    </form>
  </div>


    <!-- Main Server Form -->
     <div class="MNwrapper slide" id="slide3">
        <h3>MAIN SERVER</h3>
        <form action="">
            <div class="main">
                <button type="button" class="hb" onclick="showSlide(5)">Hospital bed</button>
                <button type="button" class="delete" onclick="deleteAccount()">delete account</button>
                <p><a href="#" onclick="toggleUserList()">รายชื่อทั้งหมด</a></p>
                <p><a href="#" onclick="showSlide(2)">ออกจากระบบ</a></p>
            </div>
            <div id="user-list-wrapper" style="display: none;">
              <h4>รายชื่อผู้ใช้ที่ลงทะเบียน</h4>
              <div id="user-list"></div>
            </div>
        </form>
    </div>

    <!-- Hospital Bed Form -->
    <div class="HBwrapper slide" id="slide5">
     <h5>Hospital Bed</h5>
      <form action="">
        <div id="bed-list">
          <!-- เตียงจะถูกสร้างด้วย JS -->
        </div>

        <div class="back">
          <p><a href="#" onclick="showSlide(3)">back</a></p>
        </div>
      </form>
    </div>

    <!-- Patient Info Slide -->
    <div class="PTwrapper slide" id="slide7">
      <h4>ข้อมูลผู้ป่วย</h4>
      <div id="patient-info-display"></div>

      <div class="back">
        <p><a href="#" onclick="showSlide(5)">กลับ</a></p>
      </div>
    </div>
  <!-- General User Page -->
    <div class="GENwrapper slide" id="slide8">
      <label class="topic">MAIN SERVER</label>
      <div class="data">
          <label>ชื่อ-นามสกุล :</label><br>
          <label>เลขบัตรประชาชน :</label><br>
          <label>เลขเตียง :</label><br>
          <label>เลขห้อง :</label><br>
          <label>เลขHN :</label><br>
          <label>อาการผู้ป่วยล่าสุด :</label><br>
          <label>แพทย์ผู้ดูแล :</label><br>
          <label>วันที่เข้ารับการรักษา :</label><br>
          <label>แผนการรักษาขั้นต่อไป :</label><br>
          <label class="time" id="current-time">12:00:00</label>
        </div>
          <div class="back1"><button type="button" onclick="showSlide(2)">back</button></div>
          <div class="Imdata">
          <label>อุณหภูมิ :</label><br>
          <label> ความดันเลือด :</label><br>
          <label> O₂ :</label><br>
          <label> อัตราการเต้นหัวใจ :</label><br>
          <label> อัตราการหายใจ :</label><br>
          <label class="fillOUT">กรอกข้อมูลเมื่อ :</label><br>
        </div>
      </div>
    </div>

  <!-- Script -->
<script>
  let currentRole = "staff"; // Default role

  function changePlaceholder(role) {
  currentRole = role; 
  const input = document.getElementById("login-id"); 
  if (role === "staff") {
    input.placeholder = "กรอกรหัสประจำตัว";
  } else if (role === "general") {
    input.placeholder = "กรอกเลขห้องผู้ป่วย";
  }
  const input1 = document.getElementById("login-password"); 
  if (role === "staff") {
    input1.placeholder = "รหัสผ่าน";
  } else if (role === "general") {
   input1.placeholder = "กรอกเลขHNผู้ป่วย";
  }
  const input2 = document.getElementById("first"); 
  if (role === "staff") {
   input2.textContent = "PROVIDER ID :";
  } else if (role === "general") {
   input2.textContent = "ROOM :";
  } 
}


  function showSlide(slideNumber) {
    document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));
    document.getElementById('slide' + slideNumber).classList.add('active');
  }

  document.querySelector("#registerForm6").addEventListener("submit", function (e) {
    e.preventDefault();

    const id = this.querySelector(".provider input").value;
    const password = this.querySelector(".passwordStaff input").value;
    const name = this.querySelector(".nameStaff input").value;
    const phone = this.querySelector(".phoneStaff input").value;
    const email = this.querySelector(".emailStaff input").value;

    let users = JSON.parse(localStorage.getItem("users")) || [];

    if (users.find(user => user.id === id)) {
      alert("รหัสนี้มีในระบบแล้ว");
      return;
    }

    users.push({ id, password, name, role: 'staff' });
    localStorage.setItem("users", JSON.stringify(users));
    alert("ลงทะเบียนสำเร็จ!");
    showSlide(2);
  });

 document.querySelector("#registerForm7").addEventListener("submit", function (e) {
  e.preventDefault();

  const password = document.getElementById("HN-id").value.trim();
  const id = document.getElementById("room-id").value.trim();
  const name = this.querySelector(".name input").value.trim();

  let users = JSON.parse(localStorage.getItem("users")) || [];

  if (users.find(user => user.id === id)) {
    alert("รหัสนี้มีในระบบแล้ว");
    return;
  }

  users.push({ id, password, name, role: 'general' });
  localStorage.setItem("users", JSON.stringify(users));
  alert("ลงทะเบียนสำเร็จ!");
  showSlide(3); 
});

  document.querySelector("#loginForm6").addEventListener("submit", function (e) {
    e.preventDefault();

    const id = this.querySelector(".username input").value;
    const password = this.querySelector(".password input").value;

    let users = JSON.parse(localStorage.getItem("users")) || [];
    const matchedUser = users.find(user => user.id === id && user.password === password && user.role === currentRole);

    if (matchedUser) {
        if (currentRole === "staff"){
         alert("เข้าสู่ระบบสำเร็จ: ยินดีต้อนรับ " + matchedUser.name);
          showSlide(3); // ไปหน้า Main Server
        }
      if (matchedUser && currentRole === "general") {
          alert("เข้าสู่ระบบสำเร็จ: ยินดีต้อนรับ " + matchedUser.name);
          showSlide(8); // ไปหน้า Main Server
        }
    } 
    else {
      alert("ไม่พบผู้ใช้หรือรหัสผ่านผิด หรือประเภทผู้ใช้ไม่ถูกต้อง");
    }
  });

  function deleteAccount() {
  const id = document.getElementById('login-id').value;
  let users = JSON.parse(localStorage.getItem("users")) || [];

  // ลบผู้ใช้ที่ id ตรงกัน
  users = users.filter(user => user.id !== id);
  localStorage.setItem("users", JSON.stringify(users));

  alert("ลบบัญชีเรียบร้อยแล้ว");
  showSlide(2); // กลับไปหน้า login
}

  let beds = [
    { id: 1, room: '1' },
    { id: 2, room: '1' },
    { id: 3, room: '2' },
    { id: 4, room: '2' }
  ];

  // โหลดสถานะจาก localStorage ถ้ามี
  function loadBedStatus() {
    const saved = localStorage.getItem('bedStatus');
    if (saved) {
      const statusMap = JSON.parse(saved);
      beds = beds.map(bed => ({
        ...bed,
        status: statusMap[bed.id] || 'ว่าง'
      }));
    } else {
      beds = beds.map(bed => ({ ...bed, status: 'ว่าง' }));
    }
  }

 function saveBedStatus() {
  const statusMap = {};
  beds.forEach(bed => {
    statusMap[bed.id] = { status: bed.status, bookedBy: bed.bookedBy || null };
  });
  localStorage.setItem('bedStatus', JSON.stringify(statusMap));
}

function loadBedStatus() {
  const saved = localStorage.getItem('bedStatus');
  if (saved) {
    const statusMap = JSON.parse(saved);
    beds = beds.map(bed => ({
      ...bed,
      status: statusMap[bed.id]?.status || 'ว่าง',
      bookedBy: statusMap[bed.id]?.bookedBy || null
    }));
  } else {
    beds = beds.map(bed => ({ ...bed, status: 'ว่าง', bookedBy: null }));
  }
}

 function renderBeds() {
  const bedList = document.getElementById('bed-list');
  bedList.innerHTML = '';

  beds.forEach((bed, index) => {
    const bedDiv = document.createElement('div');
    bedDiv.className = 'bed';
    bedDiv.innerHTML = `
      <h5>ห้อง ${bed.room}</h5>
      <p>เตียง ${bed.id}</p>
      <p>สถานะ: <span id="status-${index}">${bed.status}</span></p>
      ${
        bed.status === 'ว่าง'
          ? `<button onclick="bookBed(${index})">จอง</button>`
          : `<button onclick="cancelBooking(${index})">ยกเลิก</button>`
      } 
    `;
    bedList.appendChild(bedDiv);
  });
}

  function bookBed(index) {
  const id = document.getElementById("login-id").value.trim(); // ใช้รหัสผู้ใช้ที่ล็อกอินอยู่
  beds[index].status = 'เต็ม';
  showSlide(1);
  beds[index].bookedBy = id; // เก็บว่าใครเป็นคนจองเตียงนี้
  saveBedStatus();
  renderBeds();
  }
  function cancelBooking(index) {
  if (confirm("คุณต้องการยกเลิกการจองเตียงนี้ใช่หรือไม่?")) {
    beds[index].status = 'ว่าง';
    saveBedStatus();
    renderBeds();
    }
  }

  function showPatientInfo(index) {
  const bed = beds[index];
  const users = JSON.parse(localStorage.getItem("users")) || [];

  const matchedUser = users.find(user => user.role === 'general' && user.id === bed.bookedBy);

  const infoDiv = document.getElementById("patient-info-display");
  infoDiv.innerHTML = ''; // เคลียร์ก่อน

  if (matchedUser) {
    infoDiv.innerHTML = `
      <p><strong>ชื่อผู้ป่วย:</strong> ${matchedUser.name || '-'}</p>
      <p><strong>เลขห้อง:</strong> ${matchedUser.id}</p>
      <p><strong>เลข HN:</strong> ${matchedUser.password}</p>
    `;
  } else {
    infoDiv.innerHTML = `<p style="color:red;" >ไม่พบข้อมูลผู้ป่วยสำหรับเตียงนี้</p>`;
  }

  showSlide(7); // เปลี่ยนไปหน้า slide7
}


  // เรียกตอนเริ่ม
  loadBedStatus();
  renderBeds();
  
  function toggleUserList() {
  const wrapper = document.getElementById("user-list-wrapper");

  if (wrapper.style.display === "none") {
    wrapper.style.display = "block";
    showRegisteredUsers(); // แสดงผู้ใช้เมื่อเปิด
  } else {
    wrapper.style.display = "none";
  }
}

function showRegisteredUsers() {
  const users = JSON.parse(localStorage.getItem("users")) || [];
  const container = document.getElementById("user-list");
  container.innerHTML = '';

  if (users.length === 0) {
    container.innerHTML = "<p>ยังไม่มีผู้ใช้ลงทะเบียน</p>";
    return;
  }

  users.forEach((user) => {
    const div = document.createElement("div");
    div.style.border = "1px solid #ccc";
    div.style.margin = "5px 0";
    div.style.padding = "10px";
    div.style.borderRadius = "5px";
    div.style.background = "#fff";

    div.innerHTML = `
      <strong>ชื่อ:</strong> ${user.name || "-"}<br>
      <strong>บทบาท:</strong> ${user.role}<br>
      <strong>ID:</strong> ${user.id}<br>
      <button onclick="deleteSingleUser('${user.id}')">ลบ</button>
    `;

    container.appendChild(div);
  });
}

function deleteSingleUser(userId) {
  if (!confirm("คุณต้องการลบผู้ใช้นี้ใช่หรือไม่?")) return;

  let users = JSON.parse(localStorage.getItem("users")) || [];
  users = users.filter(user => user.id !== userId);
  localStorage.setItem("users", JSON.stringify(users));

  showRegisteredUsers(); // refresh รายชื่อใหม่
}
  setInterval(() => {
  const now = new Date().toLocaleTimeString();
  document.getElementById("current-time").innerHTML = now;
}, 1000);

</script>

</body>

</html>
